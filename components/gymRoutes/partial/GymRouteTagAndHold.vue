<template>
  <div
    class="tag-and-hold-gym-route"
    :style="`width: ${size}px`"
  >
    <div class="svg-container">
      <svg
        preserveAspectRatio="xMinYMin meet"
        class="svg-content"
        viewBox="0 0 29.999996 31.464937"
        xmlns="http://www.w3.org/2000/svg"
      >
        <defs>
          <linearGradient
            v-if="haveHold"
            :id="`${gymRoute.id}-hold-gradiant`"
            x1="0%"
            y1="0%"
            x2="100%"
            y2="0%"
          >
            <stop
              v-for="(holdColor, indexColor) in holdColors"
              :key="`gym-route-hold-index--${indexColor}`"
              :offset="`${holdColor.offset}%`"
              :style="`stop-color:${holdColor.color};stop-opacity:1`"
            />
          </linearGradient>
          <linearGradient
            v-if="haveTag"
            :id="`${gymRoute.id}-tag-gradiant`"
            x1="0%"
            y1="0%"
            x2="100%"
            y2="0%"
          >
            <stop
              v-for="(tagColor, indexColor) in tagColors"
              :key="`gym-route-tag-index--${indexColor}`"
              :offset="`${tagColor.offset}%`"
              :style="`stop-color:${tagColor.color};stop-opacity:1`"
            />
          </linearGradient>
        </defs>
        <g transform="translate(-6.2826004,-2.7284437)">
          <path
            v-if="haveHold"
            :style="`fill:url(#${gymRoute.id}-hold-gradiant);fill-opacity:1;stroke:none;stroke-width:0.0530205px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1`"
            d="M 23.707131,2.7285245 C 20.764505,2.715079 17.62354,4.5213969 15.07389,4.8152774 11.765921,5.1965617 8.9492903,6.21941 8.0876007,8.2877087 5.8511022,13.655915 5.9781195,20.806644 6.937717,22.426692 c 1.6270764,2.746921 2.6665989,4.063406 4.939922,5.586835 1.752985,1.174734 4.700314,2.855687 8.713186,3.022585 3.580596,0.148919 6.386349,-3.959899 7.719983,-6.969404 C 29.520041,21.337915 30.862457,14.008731 29.4959,9.1507399 28.893156,7.0080415 28.841419,4.5146681 26.114907,3.2410209 25.339405,2.8787586 24.531066,2.7322898 23.707131,2.7285245 Z M 18.629687,13.281268 c 1.42752,-6e-6 2.584759,1.157231 2.584753,2.584753 6e-6,1.42752 -1.157233,2.584757 -2.584753,2.584751 -1.427483,-5e-5 -2.584659,-1.157269 -2.584653,-2.584751 -6e-6,-1.427484 1.15717,-2.584703 2.584653,-2.584753 z"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#ab37c8;"
            d="M 0.083984375 13.316406 C 0.063484355 13.585596 0.04379652 13.854094 0.03125 14.115234 C -0.030468999 15.399832 0.0024793664 16.574921 0.11523438 17.564453 C 0.22798974 18.553986 0.35852879 19.318323 0.77734375 20.025391 C 1.5064664 21.256336 2.1582403 22.230612 2.8789062 23.080078 L 6.0117188 19.947266 C 5.5721551 19.41373 5.1664469 18.804045 4.7167969 18.044922 C 4.4423969 17.581665 4.3570731 17.081917 4.2832031 16.433594 C 4.2093331 15.785271 4.1880856 15.015472 4.2285156 14.173828 C 4.2418754 13.895759 4.2655718 13.607538 4.2929688 13.316406 L 0.083984375 13.316406 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#ff0000;"
            d="M 6.0117188 19.947266 L 2.8789062 23.080078 C 3.6694579 24.01192 4.5434815 24.792532 5.7070312 25.572266 C 7.1475328 26.537592 9.5008945 27.899484 12.640625 28.390625 L 12.640625 23.550781 C 10.507202 23.250417 8.9141831 22.327649 7.9472656 21.679688 C 7.1441135 21.141469 6.5514243 20.602352 6.0117188 19.947266 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#000000;"
            d="M 18.810547 19.484375 C 18.389242 20.325859 17.818156 21.233355 17.087891 22.001953 C 16.200592 22.935826 15.026681 23.700798 13.626953 23.642578 C 13.286464 23.628417 12.957523 23.595397 12.640625 23.550781 L 12.640625 28.390625 C 13.195367 28.477405 13.771629 28.541312 14.375 28.566406 C 16.511393 28.655256 18.303921 27.487867 19.658203 26.0625 C 20.632464 25.037101 21.421862 23.849528 22.035156 22.708984 L 18.810547 19.484375 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#0055d4;"
            d="M 3.2753906 3.9511719 C 2.6242597 4.4653881 2.0873393 5.1004493 1.7597656 5.8867188 C 0.76356339 8.2778759 0.26517118 10.937205 0.083984375 13.316406 L 4.2929688 13.316406 C 4.4314185 11.845179 4.7548083 10.239016 5.3613281 8.7832031 C 5.6215998 8.1584757 6.0804671 7.678089 6.6347656 7.3105469 L 3.2753906 3.9511719 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#2ca02c;"
            d="M 12.640625 0.91601562 C 11.30256 1.361722 10.117447 1.8258028 9.1992188 1.9316406 C 7.5894298 2.1171887 6.0669166 2.4533202 4.7597656 3.0527344 C 4.2260771 3.2974655 3.7246707 3.5963629 3.2753906 3.9511719 L 6.6347656 7.3105469 C 6.8529214 7.165893 7.0843026 7.0366941 7.3261719 6.9257812 C 8.1825909 6.5330568 9.179673 6.3129738 10.234375 6.1914062 C 10.870906 6.1180378 11.700401 5.7852915 12.640625 5.4785156 L 12.640625 0.91601562 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#ffcc00;"
            d="M 17.304688 0 C 15.646901 -0.0075747899 14.05757 0.44403482 12.640625 0.91601562 L 12.640625 5.4765625 C 13.529694 5.1865384 14.51886 4.9210927 15.544922 4.9257812 C 16.136255 4.9284836 16.751551 5.0376834 17.339844 5.3125 C 18.16242 5.6967525 18.705089 6.2916881 19.046875 6.9121094 L 22.748047 3.2109375 C 22.23487 2.200464 21.377412 1.2132077 20.042969 0.58984375 C 19.145052 0.17039699 18.207238 0.0041245999 17.304688 0 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#ffffff;"
            d="M 20.179688 13.316406 C 20.158322 13.781642 20.119534 14.242956 20.068359 14.693359 C 19.86995 16.439591 19.49355 17.982855 19.064453 18.951172 C 18.987886 19.123953 18.901142 19.303428 18.810547 19.484375 L 22.035156 22.708984 C 22.274378 22.264103 22.488536 21.826338 22.673828 21.408203 C 23.32876 19.930263 23.906155 17.573471 24.208984 14.908203 C 24.268284 14.386308 24.311596 13.852982 24.345703 13.316406 L 20.179688 13.316406 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="fullColors"
            style="color:#000000;fill:#ff6600;"
            d="M 22.748047 3.2109375 L 19.046875 6.9121094 C 19.122892 7.050098 19.19344 7.1896712 19.25 7.328125 C 19.560856 8.0890915 19.656997 8.8209003 19.818359 9.3945312 C 20.15984 10.608477 20.241158 11.977904 20.179688 13.316406 L 24.345703 13.316406 C 24.485777 11.112743 24.391005 8.830199 23.826172 6.8222656 C 23.579883 5.9467343 23.431497 4.8274762 22.957031 3.6660156 C 22.895113 3.5144432 22.825069 3.3625978 22.748047 3.2109375 z "
            transform="translate(5.9024505,2.3284498)"
          />
          <path
            v-if="haveHold"
            style="fill:#ffffff;fill-opacity:0.10;stroke:none"
            d="m 23.92781,2.7344283 c -0.07348,-0.0027 -0.14693,-0.00561 -0.220679,-0.00591 C 20.764505,2.715076 17.62354,4.5213939 15.07389,4.8152744 11.765921,5.1965587 8.9492903,6.219407 8.0876007,8.2877057 5.8580322,13.63928 5.9774458,20.761723 6.9289139,22.410846 7.2983014,21.78897 7.6697133,21.1803 8.0437962,20.589612 8.4404411,19.963291 8.839618,19.353969 9.2412126,18.760504 c 0.4015927,-0.593459 0.8056094,-1.17106 1.2118094,-1.733937 0.4062,-0.562875 0.814601,-1.111044 1.225065,-1.645602 0.410463,-0.534559 0.823002,-1.055496 1.237388,-1.564007 0.414388,-0.50851 0.830606,-1.004606 1.248572,-1.489336 0.417969,-0.484729 0.837619,-0.95808 1.258827,-1.4213 0.421205,-0.463226 0.84404,-0.9163273 1.268145,-1.3603107 0.4241,-0.4439845 0.849562,-0.8788265 1.27622,-1.3058394 C 18.393897,7.813162 18.821733,7.3939741 19.250605,6.9816601 19.67948,6.5693471 20.109338,6.16383 20.540084,5.7639463 20.970828,5.3640656 21.402464,4.9698185 21.834739,4.5800975 22.267014,4.1903775 22.69997,3.8052108 23.133431,3.423381 23.39776,3.1905407 23.663141,2.9650089 23.92781,2.7344253 Z"
          />
          <path
            v-if="haveHold"
            style="fill:#ffffff;fill-opacity:0.40;stroke:none"
            d="m 29.71264,10.04919 c -0.03927,0.216418 -0.07531,0.435886 -0.115981,0.650952 -0.11646,0.615745 -0.238834,1.225969 -0.367312,1.830245 -0.128479,0.604274 -0.263051,1.202626 -0.40418,1.794831 -0.141126,0.592196 -0.288808,1.178232 -0.443216,1.757751 -0.15441,0.579526 -0.315596,1.152476 -0.483918,1.718713 -0.16832,0.566246 -0.343714,1.125766 -0.52658,1.678123 -0.182866,0.552358 -0.373171,1.09759 -0.571216,1.635456 -0.198039,0.537872 -0.403859,1.068353 -0.617707,1.591136 -0.213852,0.522784 -0.435782,1.037861 -0.666072,1.54495 -0.230289,0.507088 -0.468935,1.006208 -0.716295,1.496998 -0.247361,0.490795 -0.503425,0.973299 -0.768488,1.447197 -0.132532,0.236943 -0.267309,0.471777 -0.404386,0.704383 -0.137075,0.232612 -0.276457,0.462939 -0.418158,0.691134 -0.141699,0.228195 -0.285737,0.454168 -0.432138,0.677872 -0.146401,0.22371 -0.295142,0.445167 -0.446325,0.664311 -0.151184,0.219143 -0.304781,0.436034 -0.460824,0.650541 -0.0945,0.129905 -0.191682,0.25725 -0.287988,0.385433 3.105298,-0.548859 5.520991,-4.176609 6.728952,-6.902508 1.136785,-2.565309 2.390958,-9.19607 1.401832,-14.017518 z"
          />
          <path
            v-if="haveTag && (haveHold || fullColors)"
            d="m 33.56112,16.313219 -9.196968,0.0074 a 1.8393959,1.8393959 0 0 0 -1.837934,1.840882 l 0.01176,14.715155 6.435668,-2.76424 6.440113,2.753947 -0.01178,-14.715152 c -7.31e-4,-1.020908 -0.829208,-1.83878 -1.840879,-1.837972 z"
            :style="`fill:url(#${gymRoute.id}-tag-gradiant);stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none`"
            class="gym-route-tag-color"
          />
          <path
            v-if="haveTag && !(haveHold || fullColors)"
            data-v-7d349c86=""
            d="M 29.125596,2.3284498 12.163484,2.3420978 A 3.3924267,3.3924267 0 0 0 8.7737525,5.7372653 L 8.7954425,32.876656 20.664847,27.778525 32.542448,32.857672 32.520718,5.7182873 C 32.519373,3.8354106 30.9914,2.3269965 29.125559,2.3284867 Z"
            class="gym-route-tag-color"
            :style="`fill:url(#${gymRoute.id}-tag-gradiant);stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none`"
          />
        </g>
      </svg>
    </div>
  </div>
</template>

<script>

export default {
  name: 'GymRouteTagAndHold',
  props: {
    gymRoute: {
      type: Object,
      required: true
    },
    size: {
      type: Number,
      default: 30
    }
  },

  computed: {
    holdColors () {
      return this.buildGradiantStop(this.gymRoute.hold_colors)
    },

    tagColors () {
      return this.buildGradiantStop(this.gymRoute.tag_colors, false)
    },

    haveHold () {
      return this.gymRoute.hold_colors && this.gymRoute.hold_colors.length > 0 && this.gymRoute.hold_colors[0] !== '#00000000'
    },

    fullColors () {
      return this.gymRoute.hold_colors && this.gymRoute.hold_colors.length === 1 && this.gymRoute.hold_colors[0] === '#00000000'
    },

    haveTag () {
      return this.gymRoute.tag_colors && this.gymRoute.tag_colors.length > 0
    }
  },

  methods: {
    buildGradiantStop (colors, fluid = true) {
      const numberOfColor = colors.length
      const gradiant = []
      if (numberOfColor === 1) {
        gradiant.push({ color: colors[0], offset: 0 })
        gradiant.push({ color: colors[0], offset: 100 })
      } else {
        let index = 0
        for (const color of colors) {
          if (fluid) {
            gradiant.push({ color, offset: 100 / (numberOfColor - 1) * index })
          } else {
            gradiant.push({ color, offset: 100 / numberOfColor * index })
            gradiant.push({ color, offset: 100 / numberOfColor * (index + 1) })
          }
          index++
        }
      }
      return gradiant
    }
  }
}
</script>

<style scoped lang="scss">
.tag-and-hold-gym-route {
  display: inline-block;
  .svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    vertical-align: middle;
    overflow: hidden;
    .svg-content {
      width: 100%;
      height: 100%;
      display: inline-block;
      position: absolute;
      top: 0;
      left: 0;
    }
  }
}
.theme--dark {
  .gym-route-tag-color {
    stroke: rgb(0,0,0);
  }
}
.theme--light {
  .gym-route-tag-color {
    stroke: rgb(255,255,255);
  }
}
</style>
